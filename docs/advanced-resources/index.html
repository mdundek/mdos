
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mdundek.github.io/mdos/advanced-resources/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>Advanced Resources - MDos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-resources" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MDos" class="md-header__button md-logo" aria-label="MDos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MDos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced Resources
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../installation/" class="md-tabs__link">
      Install
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../getting-started/" class="md-tabs__link">
      Getting Started
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../reference-documentation/" class="md-tabs__link">
      Reference Documentation
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Advanced Resources
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MDos" class="md-nav__button md-logo" aria-label="MDos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MDos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reference-documentation/" class="md-nav__link">
        Reference Documentation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Advanced Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Advanced Resources
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#manage-namespaces-users-roles-and-permissions" class="md-nav__link">
    Manage Namespaces, Users, Roles and Permissions
  </a>
  
    <nav class="md-nav" aria-label="Manage Namespaces, Users, Roles and Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tenant-namespaces" class="md-nav__link">
    Tenant Namespaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namespace-users-roles-and-permissions" class="md-nav__link">
    Namespace Users, Roles and Permissions
  </a>
  
    <nav class="md-nav" aria-label="Namespace Users, Roles and Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-user" class="md-nav__link">
     Create a user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-namespace-specific-roles-to-this-new-user" class="md-nav__link">
     Assign namespace specific roles to this new user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-namespace-specific-roles-for-your-applications" class="md-nav__link">
     Create namespace specific roles for your applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-applications-using-oidc-providers" class="md-nav__link">
    Securing applications using OIDC providers
  </a>
  
    <nav class="md-nav" aria-label="Securing applications using OIDC providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-mdos-keycloak-oidc" class="md-nav__link">
    Secure your application using MDos Keycloak OIDC
  </a>
  
    <nav class="md-nav" aria-label="Secure your application using MDos Keycloak OIDC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-fine-grained-acl-supported-by-keycloak-oidc" class="md-nav__link">
    Secure your application using fine grained ACL supported by Keycloak &amp; OIDC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-third-party-oidc-providers" class="md-nav__link">
    Secure your application using third party OIDC providers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-your-issuers-tls-certificates-using-cert-manager" class="md-nav__link">
    Managing your Issuers &amp; TLS Certificates using Cert-Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-your-domain-specific-ingress-gateways" class="md-nav__link">
    Managing your Domain specific Ingress-Gateways
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#populate-static-volume-data-for-your-applications" class="md-nav__link">
    Populate static volume data for your applications
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#manage-namespaces-users-roles-and-permissions" class="md-nav__link">
    Manage Namespaces, Users, Roles and Permissions
  </a>
  
    <nav class="md-nav" aria-label="Manage Namespaces, Users, Roles and Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tenant-namespaces" class="md-nav__link">
    Tenant Namespaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#namespace-users-roles-and-permissions" class="md-nav__link">
    Namespace Users, Roles and Permissions
  </a>
  
    <nav class="md-nav" aria-label="Namespace Users, Roles and Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-user" class="md-nav__link">
     Create a user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-namespace-specific-roles-to-this-new-user" class="md-nav__link">
     Assign namespace specific roles to this new user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-namespace-specific-roles-for-your-applications" class="md-nav__link">
     Create namespace specific roles for your applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-applications-using-oidc-providers" class="md-nav__link">
    Securing applications using OIDC providers
  </a>
  
    <nav class="md-nav" aria-label="Securing applications using OIDC providers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-mdos-keycloak-oidc" class="md-nav__link">
    Secure your application using MDos Keycloak OIDC
  </a>
  
    <nav class="md-nav" aria-label="Secure your application using MDos Keycloak OIDC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-fine-grained-acl-supported-by-keycloak-oidc" class="md-nav__link">
    Secure your application using fine grained ACL supported by Keycloak &amp; OIDC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-your-application-using-third-party-oidc-providers" class="md-nav__link">
    Secure your application using third party OIDC providers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-your-issuers-tls-certificates-using-cert-manager" class="md-nav__link">
    Managing your Issuers &amp; TLS Certificates using Cert-Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-your-domain-specific-ingress-gateways" class="md-nav__link">
    Managing your Domain specific Ingress-Gateways
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#populate-static-volume-data-for-your-applications" class="md-nav__link">
    Populate static volume data for your applications
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="advanced-resources">Advanced Resources</h1>
<h2 id="manage-namespaces-users-roles-and-permissions">Manage Namespaces, Users, Roles and Permissions</h2>
<h3 id="tenant-namespaces">Tenant Namespaces</h3>
<p><img align="right" alt="auth deploy" src="/mdos/img/keycloak/flow_overview.png" style="width:450px" />
Namespaces in Kubernetes are used to group resources together. You can manage your namespaces manually like you would on any Kubernetes cluster, but if you create them using the MDos CLI, then it will also create a new Client space in Keycload that is bound to the namespace in order to manage Users and roles for authentication and ACL management. This is the base for leveraging extra features on your cluster such as OIDC authentication, RBAC access control and other tenant segregation mechanisms to secure your cluster tenants.</p>
<p>If you have the MDos CLI installed on your machine, then you wont need to install the <code>kubectl</code> CLI to start managing the cluster. You can use the MDos CLI to create your tenants (and there respective kubernetes namespaces), and then create / manage your users and their permissions for those tenant namespaces using the same CLI (more on the Users, roles and permissions in the next section). Those users will then use the MDos CLI to install and configure their respective <code>kubectl</code> CLI according to their roles and permissions (RBAC).  </p>
<p>Simply create a new tenant / namespace like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>mdos ns create
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, only the platform <code>admin</code> can create namespaces. Once you have created other users on the platform, you can give them permissions to create tenant namespaces as well if you wish to delegate tenant management tasks to them.</p>
</div>
<h3 id="namespace-users-roles-and-permissions">Namespace Users, Roles and Permissions</h3>
<p>If you created a tenant namespace using the MDos CLI, then you will be able to manage users and user roles for this namespace using Keycloak (authentication is based on OIDC OAuth2).<br />
In Keycloak, you create <code>clients</code> and <code>users</code>, then for clients you can create client specific <code>roles</code>. Finally you will assign specific client <code>roles</code> to those <code>users</code>.<br />
MDos comes with a system client called <code>mdos</code> that is used to assign global administrative roles to your users. On top of this, every namespace you create using the MDos CLI will create it's own dedicated <code>client</code> in Keycloak. Those namespaces have a few pre-defined roles already available for tenant specific permission management, <strong>but then you can then create your own roles inside this <code>client</code> space that you can leverage to implement your ACL layer inside your applications</strong> (more on this in the section <a href="/mdos/advanced-resources/#securing-applications-using-oidc-providers">Securing applications using OIDC providers</a>).</p>
<p><img align="left" alt="Clients and roles" src="/mdos/img/keycloak/client_roles.png" style="width:410px" /></p>
<table>
<thead>
<tr>
<th align="center">Keycloak client</th>
<th>Role name</th>
<th>Permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>mdos</code></td>
<td>admin</td>
<td>No limitations, can do everything</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>create-namespace</td>
<td>Create new clients / namespaces</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>list-namespace</td>
<td>List all clients / namespaces</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>delete-namespace</td>
<td>Delete a client / namespace</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>create-users</td>
<td>Create new users</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>list-users</td>
<td>List / read all users</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>delete-users</td>
<td>Delete users</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>create-roles</td>
<td>Create client roles for any client</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>delete-roles</td>
<td>Delete client roles from any client</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>assign-roles</td>
<td>Assign client roles for any client and to any user</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>cm-cluster-issuer</td>
<td>Create and delete Cert-manager ClusterIssuers</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>oidc-create</td>
<td>Can create a new OIDC oauth2 endpoint for applications to use</td>
</tr>
<tr>
<td align="center"><code>mdos</code></td>
<td>oidc-remove</td>
<td>Can delete OIDC oauth2 endpoints</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center">Keycloak client</th>
<th>Role name</th>
<th>Permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>tenant-namespace</code></td>
<td>k8s-write</td>
<td>Can deploy / delete / update applications on the client namespace using the Mdos API</td>
</tr>
<tr>
<td align="center"><code>tenant-namespace</code></td>
<td>k8s-read</td>
<td>Can list applications on the client namespace using the Mdos API</td>
</tr>
<tr>
<td align="center"><code>tenant-namespace</code></td>
<td>admin</td>
<td>Create / delete namespace specific client roles. Assign namespace specific client roles to any user. List all users for this client namespace.</td>
</tr>
<tr>
<td align="center"><code>tenant-namespace</code></td>
<td><strong>-your own role-</strong></td>
<td>Create your own custom role names to use within your applications</td>
</tr>
</tbody>
</table>
<h4 id="create-a-user"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 16.94v-4H5.08l-.03-2.01H14V6.94l5 5Z"/></svg></span> Create a user</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>mdos auth user create
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will be given the opportunity to assign existing roles to your new user directly after the new user is created. Of course, you can choose not to for now, and use the command <code>mdos auth user add-role</code> to do so at any time.</p>
</div>
<h4 id="assign-namespace-specific-roles-to-this-new-user"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 16.94v-4H5.08l-.03-2.01H14V6.94l5 5Z"/></svg></span> Assign namespace specific roles to this new user</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="hll">mdos auth user add-role
</span><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>? Do you want to add a role from the Mdos admin client or from a tenant client? <span class="o">(</span>Use arrow keys<span class="o">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>❯ Mdos admin client role
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  Tenant client role
</code></pre></div>
<p>Here you have the choice between assigning roles from the Keycloak <code>mdos</code> client or from one of your own <code>tenant</code> spacific client. Let's choose to add a <code>mdos</code> client role to this ne user.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>? Do you want to add a role from the Mdos admin client or from a tenant client? Mdos admin client role
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>? Select a role to add from this client: <span class="o">(</span>Use arrow keys<span class="o">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>❯ create-roles
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  create-users
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  delete-namespace
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  oidc-create
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>  assign-roles
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  cm-cluster-issuer
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>  delete-users
</code></pre></div>
<p>Once you have choosen what role to assign to your user, enter that <code>username</code> to attach the role to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>? Select a role to add from this client: create-namespace
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>? What username <span class="k">do</span> you wish to add this client role to: my-user-one
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Add role to user... <span class="k">done</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to the table in the beginning of this chapter for more details on the various roles you can assign to your users.</p>
</div>
<h4 id="create-namespace-specific-roles-for-your-applications"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 16.94v-4H5.08l-.03-2.01H14V6.94l5 5Z"/></svg></span> Create namespace specific roles for your applications</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="hll">mdos auth tenant create-role 
</span><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>? Select a Client ID to create a Role <span class="k">for</span>: food-shop
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>? Enter the client role name to create: edit-recipe
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>Creating Keycloak client role... <span class="k">done</span>
</code></pre></div>
<p>Just like we added a <code>mdos</code> client specific role to our new user, you can now assign this new namespace scoped role <code>edit-recipe</code> to your users as well. For more information on how to use those custom roles, see the chapter (more on this in the section <a href="/mdos/advanced-resources/#securing-applications-using-oidc-providers">Securing applications using OIDC providers</a>.</p>
<hr />
<h2 id="securing-applications-using-oidc-providers">Securing applications using OIDC providers</h2>
<p>You can protect your applications using OAuth2 OIDC without having to write a single line of code or modify your applications in any way. You have the option of a variaty of OIDC providers such as Keycloak, Google, GitHub and others.</p>
<p><img alt="OIDC" src="/mdos/img/oidc.png" /></p>
<h3 id="secure-your-application-using-mdos-keycloak-oidc">Secure your application using MDos Keycloak OIDC</h3>
<p>While you can use various OIDC providers to protect your applications using OIDC authentication, using the integrated Keycloak deployment for your user authentication needs will allow you to also manage your application specific RBAC setup by defining roles and assigning them to your users. MDos uses the open-source solution <a href="https://github.com/oauth2-proxy/oauth2-proxy">oauth2-proxy</a> to abstract away the complexity of implementing OAuth2 authentication workflows for your applications.</p>
<h4 id="secure-your-application-using-fine-grained-acl-supported-by-keycloak-oidc">Secure your application using fine grained ACL supported by Keycloak &amp; OIDC</h4>
<p>Let's start by having a look at how you can leverage <code>Keycloak</code> and OIDC to implement your RBAC rules to your applications.<br />
The first step is to create a new <code>oauth2-proxy</code> provider instance for the integrated Keycloak deployment to your target namespace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="hll">mdos oidc provider add
</span><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>? What OIDC target <span class="k">do</span> you want to add to the platform? Keycloak client
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>? Select a Client ID tenant-one
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>Creating Keycloak client <span class="p">&amp;</span> OIDC provider... <span class="k">done</span>
</code></pre></div>
<p>Thats it, you application can now refer to it in order to implement authentication to your application without writing a single line of code. Here is an example that adds OIDC authentication to your specific ingress domain name for an application component:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>schemaVersion: v1
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>tenantName: your-tenant-name
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>appName: my-app
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>uuid: XA74S-FXCDI
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>components:
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  - name: secret-app-component
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    image: your-tenant-name/my-app
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    uuid: E5PLU-TQMBD
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    tag: <span class="m">1</span>.1.0
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    services:
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>      - name: http
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        ports:
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>          - port: <span class="m">80</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    ingress:
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>      - name: main
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="hll">        matchHost: secret.mydomain.com
</span><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        targetPort: <span class="m">80</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        trafficType: http
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    oidc:
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="hll">      provider: kc-tenant-one
</span><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>      hosts:
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="hll">        - secret.mydomain.com
</span></code></pre></div>
<p>In this example, we link our new oauth2-proxy <code>kc-tenant-one</code> to our application component <code>secret-app-component</code>, and protect the domain <code>secret.mydomain.com</code> with it.  </p>
<p>Once this application is deployed and you try to access it on the domain <code>secret.mydomain.com</code>, you will be redirected to the Keycloak login page. Once authenticated through Keycloak, you will gain access to your secret application.  </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The domain name you protect has be be configured as an ingress to this application component as well, otherwise there is no access to this component to protect in the first place.</p>
</div>
<p>But that's not all we can do here, let's go one step further and have a look as of how you can leverage your user sessions and their associated roles using your own ACL / RBAC layer from within your application (creating users and roles, as well as assigning roles to those users is described in the chapter <a href="/mdos/advanced-resources/#namespace-users-roles-and-permissions">Namespace Users, Roles and Permissions</a>).<br />
Once this user hits your application, the user is already authenticated and we are sure that we have a valid JWT token available in the header of the request under the property named <code>authorization</code>. So all we have to do now is to decode this JWT token using a language specific JWT library (all modern languages have such a library available, usually through a third party library). Once decoded, you will find all keycloak <code>clients</code> (corresponding to the application tenant namespace) this user has permissions for, as well as the specific roles added to this specific user in each respective client space. Simply use this information to allow / disallow fine grained access to the various features of your application:</p>
<div class="highlight"><span class="filename">JWT token client roles once decoded</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>resource_access.&lt;CLIENT_NAMESPACE&gt;.roles<span class="o">[</span><span class="s1">&#39;role-1&#39;</span>, <span class="s1">&#39;role-2&#39;</span>, ...<span class="o">]</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In the near future, it will be possible to specify global access to an application based on user roles directly from within your <code>mdos.yaml</code> configuration file. This will not allow you to do fine grained access control to specific users on specific parts of your application like the example we are showing you here, but il will allow you to restrict <strong>global</strong> access to applications based on their user roles without having to implement anything on your side. This new feature is currently under developement.</p>
</div>
<h4 id="secure-your-application-using-third-party-oidc-providers">Secure your application using third party OIDC providers</h4>
<p>You can also leverage public OIDC providers for your authentication needs such as Google, Github and others. To do so, you will have to configure your external auth provider in order to get your access key, necessary to configure the <code>oauth2-proxy</code> instance dedicated for this external OIDC provider.<br />
For more information of how to configure your Google account for instance can be found <a href="https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/oauth_provider/#google-auth-provider">here</a>.  </p>
<p>Creating a Google auth based OIDC provider, use the command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>mdos oidc provider add -t google
</code></pre></div>
<p>and follow the directions.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>As of now, only Google is available through the MDos platform as an external OIDC provider. Github authentication and others will follow soon.</p>
</div>
<hr />
<h2 id="managing-your-issuers-tls-certificates-using-cert-manager">Managing your Issuers &amp; TLS Certificates using Cert-Manager</h2>
<hr />
<h2 id="managing-your-domain-specific-ingress-gateways">Managing your Domain specific Ingress-Gateways</h2>
<hr />
<h2 id="populate-static-volume-data-for-your-applications">Populate static volume data for your applications</h2>
<p><img align="right" alt="Volume sync" src="/mdos/img/volume-sync.png" style="width:600px" />
Every new volume that is created for your application is completely empty at first! This is how Kubernetees deals with volumes (also known as Persisted Volumes in the Kubernetes world)? So what if I have some data that I would like to put into this volume that my application depends on? Initial database schema &amp; dataset, a static website that serves as a base for my application etc. Often it is exactly what you want in a persisted volme, but sometimes your volumes need data to be present at application startup. So what usually happens is that you have to complexify your app with all sorts of init mechanisms that detect an empty volume, and populate it before you can actually start using it. Bringing data to PVCs is difficult!<br />
MDos provides an efficient way for dealing with those use-cases. An MDos application project can have volumes declared that contain data you wish to pre-load onto your PODs before your application starts on the cluster. You will simply have to add the flag <code>syncVolume: true</code> to the declared volume inside your application component in your <code>mdos.yaml</code> file, and mdos will automatically sync this volume data to your pod volume before it starts your application component (see <a href="/mdos/reference-documentation/#pre-populate-volumes">Pre-populate volumes</a> in the reference documentation for an example configuration for your <code>mdos.yaml</code> file).  </p>
<p>Let's have a look at the above example to see in details what actually happens here:</p>
<table>
<thead>
<tr>
<th align="center">Step</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>1</code></td>
<td>When the user runs the command <code>mdos application deploy</code>, the CLI will look for <code>volumes</code> that are flagged with the attribute <code>syncVolume: true</code> in all application components.</td>
</tr>
<tr>
<td align="center"><code>2</code></td>
<td>The MDos CLI will then initiate a ftp mirror command to synchronize your local volume files with the MDos FTP server</td>
</tr>
<tr>
<td align="center"><code>3</code></td>
<td>Then your application is deployed onto the cluster</td>
</tr>
<tr>
<td align="center"><code>4</code></td>
<td>Before the application actually starts, it will first mirror back your volume data from the MDos FTP server to your application <code>Persisted Volume</code></td>
</tr>
<tr>
<td align="center"><code>5</code></td>
<td>Once the data is fully synchronized, your application starts up and has access to your pre-loaded files</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All this happens automatically with the command <code>mdos application deploy</code>, you do not need to worry about these steps, nevertheless it is usefull for you to understant what is actually happening under the hood.</p>
</div>



  



                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../reference-documentation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Reference Documentation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Reference Documentation
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.annotate"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>