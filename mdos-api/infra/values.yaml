registry: registry.<DOMAIN>
tenantName: mdos
appName: mdos
uuid: KG75-7D58-mdos
forceUpdate: true
components:
  - name: broker
    uuid: KG75-7D58-broker
    image: mdos-broker
    tag: latest
    imagePullSecrets:
      - name: regcred
    imagePullPolicy: Always
    services:
      - name: http
        ports:
          - name: http-3039
            port: 3039
    volumes:
      - name: db-volume
        mountPath: /usr/src/db
    configs:
      - name: configs
        type: env
        entries:
          - key: SQLITE_FILE_PATH
            value: "/usr/src/db/mdos_broker.sqlite"
  - name: api
    uuid: KG75-7D58-api
    image: mdos-api
    tag: latest
    imagePullSecrets:
      - name: regcred
    imagePullPolicy: Always
    services:
      - name: http
        ports:
          - name: http-3030
            port: 3030

    ingress:
      - name: http-ingress
        matchHost: mdos-api.<DOMAIN>
        targetPort: 3030
        trafficType: http
        
    configs:
      - name: configs
        type: env
        entries:
          - key: ROOT_DOMAIN
            value: "<DOMAIN>"
          - key: GEN_HELM_PATH_PATH
            value: "/usr/src/dep/mhc-generic"
          - key: ISTIO_CHART_PATH
            value: "/usr/src/dep/istio_helm/istio-control/istio-discovery"
          - key: RUN_TARGET
            value: "pod"
          - key: FTP_SERVER_MAIN_PORT
            value: "3915"
          - key: K3S_CLIENT_CA_PATH
            value: "/usr/src/dep/k3s/client-ca.crt"
          - key: K3S_CLIENT_KEY_PATH
            value: "/usr/src/dep/k3s/client-ca.key"
          - key: KC_PORT
            value: "30999"
          - key: API_MODE
            value: "FULL"
          - key: BROKER_CLIENT
            value: http://mdos-broker-http:3039

    secrets:
      - name: creds
        type: env
        entries:
          - key: REG_USER
            value: "mdundek"
          - key: REG_PASS
            value: "li14ebe14"
      - name: k3s-ca
        type: file
        mountPath: /usr/src/dep/k3s
        entries:
          - key: client-ca
            filename: client-ca.crt
            value: |-
              -----BEGIN CERTIFICATE-----
              MIIBdzCCAR2gAwIBAgIBADAKBggqhkjOPQQDAjAjMSEwHwYDVQQDDBhrM3MtY2xp
              ZW50LWNhQDE2NjgyODY4NzYwHhcNMjIxMTEyMjEwMTE2WhcNMzIxMTA5MjEwMTE2
              WjAjMSEwHwYDVQQDDBhrM3MtY2xpZW50LWNhQDE2NjgyODY4NzYwWTATBgcqhkjO
              PQIBBggqhkjOPQMBBwNCAATKv3+3JHRZhHYZ6gSAhS+DZ3KqKy8z3Olx3gjH9CLk
              +iXYVILEsxC+X2QCVxMhKzVLgZE3TDpx5Qe2pcki/Avmo0IwQDAOBgNVHQ8BAf8E
              BAMCAqQwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkel05YvriJTcE44HPe0D
              YE7FxKAwCgYIKoZIzj0EAwIDSAAwRQIgHTup3mWeNlaeJvNX4ePsWO+JzIHD92Ho
              GPXjaNj5Hl4CIQCh9PH1EbFywtsvFxm8ESRUjVP3m2TosKVVeOeuxP7KXQ==
              -----END CERTIFICATE-----
          - key: client-key
            filename: client-ca.key
            value: |-
              -----BEGIN EC PRIVATE KEY-----
              MHcCAQEEIKAM/nDpnGRmsi3RFCcQAM4mDgSXeFiUfd3P4n+kdR5uoAoGCCqGSM49
              AwEHoUQDQgAEyr9/tyR0WYR2GeoEgIUvg2dyqisvM9zpcd4Ix/Qi5Pol2FSCxLMQ
              vl9kAlcTISs1S4GRN0w6ceUHtqXJIvwL5g==
              -----END EC PRIVATE KEY-----
        
    volumes:
      - name: istiod-helm-volume
        mountPath: /usr/src/dep/istio_helm/istio-control/istio-discovery
        hostPath: /home/mdundek/mdos/mdos-setup/dep/istio_helm/istio-control/istio-discovery
          
    oidc:
      issuer: https://keycloak.<DOMAIN>:30999/realms/mdos
      jwksUri: https://keycloak.<DOMAIN>:30999/realms/mdos/protocol/openid-connect/certs
      provider: kc-mdos
      hosts:
        - mdos-api.<DOMAIN>
      excludePaths:
        - /registry_domain
        
    nodeSelector:
      label: mdos-stack
      value: true
